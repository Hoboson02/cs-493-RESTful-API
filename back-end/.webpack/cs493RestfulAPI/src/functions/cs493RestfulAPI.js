(()=>{"use strict";var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{handler:()=>l});const s=require("@aws-sdk/client-dynamodb"),n=require("@aws-sdk/lib-dynamodb"),o=new s.DynamoDBClient({region:"us-west-2"}),a=n.DynamoDBDocumentClient.from(o);async function i(e,t,s,o){const i={TableName:e,Key:{[t]:s},UpdateExpression:`REMOVE ${o.join(".")}`,ReturnValues:"ALL_NEW"};try{await a.send(new n.UpdateCommand(i)),console.log("Delete succeeded")}catch(e){console.error("Delete failed",e)}}async function r(e,t,s,o,i){const r=JSON.parse(i),l={TableName:e,Key:{[t]:s},UpdateExpression:`SET ${Object.keys(r).map((e=>`${o.join(".")}.${e} = :${e}`)).join(", ")}`,ExpressionAttributeValues:Object.entries(r).reduce(((e,[t,s])=>(e[`:${t}`]=s,e)),{})};try{await a.send(new n.UpdateCommand(l)),console.log("Update succeeded")}catch(e){console.error("Update failed",e)}}const l=async e=>{const t=e.httpMethod;let s=await a.send(new n.ScanCommand({TableName:"api-gateway-test"}));console.log(s);const o={isBase64Encoded:!1,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}};if("object"==typeof s){o.statusCode=200;var l=JSON.stringify(e.path);l.replace('"',"");const n=l.split("/");n.shift(),n[n.length-1]=n[n.length-1].replace('"',"");const a=s.Items[0],d=s.Items[1];switch(t){case"GET":if("business"==n[0]){let e=a;if(n.length>=1){e=e.entityName;for(let t=1;t<n.length;t++)e=e[n[t]]}o.body=JSON.stringify(e)}else if("user"==n[0]){let e=d;if(n.length>=1){e=e.entityName;for(let t=1;t<n.length;t++)e=e[n[t]]}o.body=JSON.stringify(e)}else o.body=JSON.stringify(s.Items);break;case"POST":const l=e.body;if("business"==n[0]){let e=["entityName"];for(let t=1;t<n.length;t++)e.push(n[t]);r("api-gateway-test","id","business",e,l),o.body=JSON.stringify(e)}else"user"==n[0]?(r("api-gateway-test","id","user",["entityName"],l),o.body=JSON.stringify(e)):o.body=JSON.stringify(s.Items);break;case"DELETE":if("business"==n[0]){let e=["entityName"];for(let t=1;t<n.length;t++)e.push(n[t]);i("api-gateway-test","id","user",e),o.body=JSON.stringify(e)}else if("user"==n[0]){let e=d;n.length>=1&&(e=e.entityName,n.length>=2&&(e=e[n[1]],n.length>=3&&(e=e[n[2]],n.length>=4&&(e=e[n[3]])))),i("api-gateway-test","id","user",e),o.body=JSON.stringify(e)}else o.body=JSON.stringify(s.Items);break;default:o.body=`Unknown request: ${t}`}}else o.statusCode=500;return o};var d=exports;for(var y in t)d[y]=t[y];t.__esModule&&Object.defineProperty(d,"__esModule",{value:!0})})();